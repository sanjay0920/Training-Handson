use Library

create table Member(
Member_Id int Primary Key Not null,
Account_Open_Date Datetime,
Max_Allowed_Books numeric,
Penalty_Amount money
)

Alter table Member
Add constraint def_date_account
Default getdate() for Account_Open_Date;

Alter table Member
Add constraint allowed_max
check (Max_Allowed_Books <100)

Alter table Member
Add constraint allowed_penalty
check (Penalty_Amount <1000)

create table Book(
Book_No numeric primary key not null,
Book_Name varchar(25) not null,
Category varchar(30) check(Category='Science' or Category='Fiction' or Category='Database' or Category='RDBMS' OR Category='Others')
)

Create table Issue(
Lib_Issue_Id numeric primary key not null,
Member_Id numeric ,
Book_No numeric,
Issue_Date DateTime,
Return_Date DateTime 
)

Alter table Issue
Alter column Member_Id int

Alter table Issue
Add Constraint add_pk_fk
Foreign key (Member_Id) references Member(Member_Id)

Alter table Issue
Add Constraint add_pk_fk_book
Foreign key (Book_No) references Book(Book_No)

Alter table Issue
Add Constraint Chec_Date
check(Return_Date>Issue_Date)

Alter table Book
Add Price numeric(5,2) check(Price<2500)
go

Create view [User_Constraints] As
Select CONSTRAINT_TYPE,CONSTRAINT_NAME
FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS
WHERE TABLE_NAME='Issue';
go

select* from [User_Constraints]
go

Alter table Issue
nocheck Constraint Chec_Date


insert into Member values(1,'2012-04-13',45,250)
insert into Book values(123,'harry potter','Fiction',250)
insert into Book values(101,'book2','Fiction',250)
insert into Issue values(123,1,101,'2011-11-11','2011-11-11')

select* from Issue
select* from Book

Insert into Member values(7,'2005-12-10',5,50)
Insert into Member values(2,GETDATE(),3,NULL)
Insert into Member values(3,Null,4,79.80)
Insert into Member values(4,GETDATE(),null,56)
Insert into Member values(5,'2018-06-09',4,50)

Insert into Book values(105,'Let us C','Science',450)
Insert into Book values(102,'Oracle','Database',550)
Insert into Book values(103,'Mastering SQL','Database',250)
Insert into Book values(104,'PL SQL','Database',750)

Insert into Issue values(7001,1,101,'2006-12-10',null),(7002,2,102,'2006-12-25',null),(7003,1,104,'2006-01-15',null),(7004,1,101,'2006-06-04',null),
(7005,2,104,'2006-11-15',null),(7006,3,103,'2006-02-18',null)

go
create view review1 as
select distinct Lib_Issue_Id,Book_Name,I.Member_Id,Issue_Date from Member M inner join Issue I
on M.Member_Id=I.Member_Id INNER JOIN Book B on I.Book_No = B.Book_No
where Price Between 500 and 750
go 


select* from review1

go
create or Alter view Pricegreaterthan500 
as
select Book_No,Book_Name,Category,Price from Book
where Price >500
go
select* from Pricegreaterthan500
select* from Book

insert into Pricegreaterthan500(Book_No,Book_Name) values(108,'Electronics basics -1')

Update Pricegreaterthan500 set Category='Science' where Book_No = 102;
go

delete Issue where Book_No=104
delete Pricegreaterthan500 where Book_No = 104

create Index Bookn on Book(Book_Name)

create Index Index2 on Issue(Member_Id,Book_No)



create Index index3 on Member(Member_Id)




SELECT * 
FROM sys.indexes 
WHERE name='bookn' AND object_id = OBJECT_ID('Book')